<div class="flex flex-col h-full w-full bg-gray-50 overflow-hidden">
  <div #scrollContainer class="flex-grow overflow-y-auto p-4">
    <div class="w-full md:max-w-5xl md:mx-auto flex flex-col space-y-4">
      
      @for (msg of messages; track $index) {
        <div
          class="flex w-full"
          [ngClass]="msg.isUser ? 'justify-end' : 'justify-start'"
        >
          <div
            [ngClass]="{
              'bg-blue-600 text-white rounded-l-2xl rounded-tr-2xl shadow-blue-100':
                msg.isUser,
              'bg-white text-gray-800 border border-gray-200 rounded-r-2xl rounded-tl-2xl shadow-sm':
                !msg.isUser
            }"
            class="max-w-[85%] md:max-w-[70%] p-3 shadow-sm break-words"
          >
            <p class="text-sm whitespace-pre-wrap leading-relaxed">
              {{ msg.text }}
            </p>

            <span 
              class="text-[10px] opacity-70 block mt-1"
              [class.text-right]="true"
            >
              {{ msg.timestamp | date: "HH:mm" }}
            </span>
          </div>
        </div>
      }

      @if (isLoading) {
        <div class="flex justify-start w-full">
          <div
            class="bg-gray-200 p-3 rounded-2xl animate-pulse text-xs text-gray-500 flex items-center gap-2 rounded-tl-none"
          >
            <div class="flex gap-1">
              <span
                class="w-1 h-1 bg-gray-400 rounded-full animate-bounce"
              ></span>
              <span
                class="w-1 h-1 bg-gray-400 rounded-full animate-bounce [animation-delay:0.2s]"
              ></span>
              <span
                class="w-1 h-1 bg-gray-400 rounded-full animate-bounce [animation-delay:0.4s]"
              ></span>
            </div>
            AI thinking...
          </div>
        </div>
      }

      @if (messages.length === 0 && !isLoading) {
        <div
          class="h-full flex flex-col items-center justify-center text-gray-400 space-y-2 opacity-60 py-10"
        >
          <mat-icon class="scale-150">auto_awesome</mat-icon>
          <p class="text-sm">How can I help you today?</p>
        </div>
      }
    </div>
  </div>

  <div
    class="shrink-0 bg-white/80 backdrop-blur-md border-t border-gray-100 p-4 pb-6"
  >
    <div class="flex gap-2 w-full max-w-5xl mx-auto">
      <div
        class="relative flex-grow flex flex-col bg-gray-50 border border-gray-200 rounded-2xl transition-all duration-200 focus-within:border-primary focus-within:ring-4 focus-within:ring-blue-500/10 focus-within:bg-white shadow-sm overflow-hidden"
      >
        <div class="flex items-center w-full pl-4 pr-2">
          <input
            type="text"
            [(ngModel)]="message"
            (keydown.enter)="sendMessage()"
            class="flex-grow bg-transparent border-none outline-none text-base md:text-sm text-gray-900 py-3 placeholder:text-gray-400"
            placeholder="Enter yout message to AI..."
          />
        </div>
      </div>

      <button
        (click)="sendMessage()"
        [disabled]="!message"
        class="shrink-0 flex items-center justify-center w-11 h-11 rounded-xl cursor-pointer bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all duration-200 shadow-lg shadow-blue-500/30 text-white"
      >
        <mat-icon class="text-[20px] leading-none transform translate-x-0.5"
          >send</mat-icon
        >
      </button>
    </div>
  </div>
</div>