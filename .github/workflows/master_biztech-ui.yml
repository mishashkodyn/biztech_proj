name: Deploy Angular & .NET API to Azure

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # --- 1Ô∏è‚É£ Checkout –∫–æ–¥ ---
      - name: Checkout repository
        uses: actions/checkout@v4

      # --- 2Ô∏è‚É£ Build Angular ---
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install and Build Angular
        working-directory: ./client  # üîπ —à–ª—è—Ö –¥–æ —Ç–≤–æ–≥–æ —Ñ—Ä–æ–Ω—Ç—É
        run: |
          npm install
          npm run build --prod

      # --- 3Ô∏è‚É£ Build .NET API ---
      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 8.0.x

      - name: Restore and Build .NET
        working-directory: ./  # üîπ —à–ª—è—Ö –¥–æ —Ç–≤–æ–≥–æ –±–µ–∫–µ–Ω–¥—É
        run: |
          dotnet restore
          dotnet publish -c Release -o publish

      # --- 4Ô∏è‚É£ Deploy Angular to Azure App Service ---
      - name: Deploy Angular to Azure
        uses: azure/webapps-deploy@v3
        with:
          app-name: YOUR-FRONTEND-APP-NAME  # üîπ –Ω–∞–∑–≤–∞ —Ñ—Ä–æ–Ω—Ç–æ–≤–æ–≥–æ App Service
          publish-profile: ${{ secrets.AZUREAPPSERVICE_PUBLISH_PROFILE_FRONT }}
          package: ./frontend/dist  # —à–ª—è—Ö –¥–æ –∑—ñ–±—Ä–∞–Ω–æ–≥–æ Angular

      # --- 5Ô∏è‚É£ Deploy .NET API to Azure App Service ---
      - name: Deploy .NET API to Azure
        uses: azure/webapps-deploy@v3
        with:
          app-name: YOUR-BACKEND-APP-NAME  # üîπ –Ω–∞–∑–≤–∞ –±–µ–∫–µ–Ω–¥ App Service
          publish-profile: ${{ secrets.AZUREAPPSERVICE_PUBLISH_PROFILE_BACK }}
          package: ./backend/publish

